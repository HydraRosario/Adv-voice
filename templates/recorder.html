<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Asistente Adventista</title>
    <link rel="icon" type="image/png" href="static/img/favicon.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="static/recorder.css">
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600&display=swap" rel="stylesheet">
  </head>
  <body>
    <div class="container main-container">
        <div class="header">
            <img src="static/img/logo-adventista.png" alt="Logo Adventista" class="logo">
            <h1>Asistente Bíblico Digital</h1>
            <p class="verse">"Lámpara es a mis pies tu palabra, y lumbrera a mi camino" - Salmos 119:105</p>
        </div>

        <div class="chat-section">
            <div class="messages-container">
            </div>
        </div>

        <div class="input-section">
            <div class="input-container">
                <input type="text" class="form-control message-input" id="textInput" placeholder="Escribe tu pregunta aquí..." aria-label="Campo de texto para escribir mensaje">
                <button class="send-button" onclick="sendText()" aria-label="Enviar mensaje">
                    Enviar
                </button>
                <button type="button" class="record-button" id="record" onclick="record()" aria-label="Iniciar grabación de audio">
                    Grabar
                </button>
                <button type="button" class="stop-button" id="stop" onclick="stop()" style="display:none" aria-label="Detener grabación">
                    Detener
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="static/recorder.js"></script>

    <script type="text/javascript">
        function playAudio(audioFile) {
            let audio = new Audio();
            audio.src = "/static/" + audioFile + "?t=" + new Date().getTime();
            audio.addEventListener('error', function(e) {
                console.error('Error loading audio:', e);
            });
            audio.addEventListener('loadeddata', function() {
                console.log('Audio loaded successfully');
                audio.play().catch(function(error) {
                    console.error('Error playing audio:', error);
                });
            });
            return audio;
        }

        recorder("/audio", response => {
            document.getElementById("record").style.display="";
            document.getElementById("stop").style.display="none";
            document.getElementById("text").innerHTML = response.text;
            document.getElementById("神").innerHTML = response.神;
            
            if (typeof response.file !== "undefined") {
                audioFile = response.file;
                let audio = new Audio();
                audio.setAttribute("src", "static/" + audioFile + "?t=" + new Date().getTime());
                audio.play();
                scrollToBottom();
            }
        });
    </script>
  </body>
</html>